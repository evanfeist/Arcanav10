<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Arcana – Stage 1–3 (P2P)</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#0f1620; --ink:#e6edf3; --muted:#9fb0c3; --accent:#8fd3ff; --danger:#ff9fb0; --ok:#9fffb0;
  }
  html,body{height:100%}
  body{margin:0;background:#0b0f14;color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,"Noto Sans",sans-serif}
  header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid #1d2732;background:linear-gradient(180deg,#0f1620,#0b0f14)}
  header h1{margin:0;font-size:16px}
  .wrap{display:grid;grid-template-columns: 300px 1fr 340px;gap:12px;padding:12px}
  .col{background:rgba(255,255,255,.03);border:1px solid #1d2732;border-radius:12px;overflow:hidden}
  .col h2{margin:0;padding:10px 12px;font-size:13px;color:var(--muted);border-bottom:1px solid #1d2732;background:linear-gradient(180deg,#0f1722,#0d141d)}
  .panel{padding:10px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  input[type=text]{background:#0e1723;border:1px solid #223040;border-radius:8px;color:var(--ink);padding:6px 8px;min-width:220px}
  button{appearance:none;border:1px solid #213041;background:#111925;color:var(--ink);padding:7px 10px;border-radius:10px;font-weight:600;font-size:12px;cursor:pointer}
  button:hover{background:#152235}
  .pill{display:inline-block;border:1px solid #2a3a4e;border-radius:999px;padding:2px 8px;font-size:11px;color:#cfe1f7}
  .pill.ok{border-color:#1f3d2a;color:#bfffd1}
  .pill.bad{border-color:#4b1b26;color:#ffc1ca}
  .piles{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:8px}
  .pile{position:relative;width:64px;height:88px;border-radius:10px;background:repeating-linear-gradient(135deg,#0e1520 0px,#0e1520 8px,#0c111a 8px,#0c111a 16px);border:1px solid #223040}
  .count-tag{position:absolute;top:-9px;right:-9px;background:#0c1722;border:1px solid #2a3a4e;border-radius:999px;min-width:26px;height:22px;display:grid;place-items:center;font-size:12px;color:#cfe1f7}
  .pile .label{position:absolute;left:50%;bottom:-18px;transform:translateX(-50%);font-size:12px;color:var(--muted)}
  .zone{display:flex;flex-direction:column;gap:8px}
  .group{display:flex;gap:6px;flex-wrap:wrap}
  .group-title{font-size:12px;color:var(--muted)}
  .cardui{width:64px;height:88px;border-radius:10px;border:1px solid #2a3a4e;background:linear-gradient(180deg,#151e2a,#0f1620);box-shadow:0 4px 14px rgba(0,0,0,.35);position:relative;user-select:none;cursor:pointer}
  .cardui.back{cursor:default}
  .cardui .rank{position:absolute;left:6px;top:4px;font-weight:800;font-size:14px}
  .cardui .suit{position:absolute;right:6px;bottom:4px;font-size:14px}
  .cardui .type{position:absolute;left:6px;bottom:4px;font-size:10px;color:var(--muted)}
  .cardui.selected{outline:2px solid var(--accent);box-shadow:0 10px 30px rgba(143,211,255,.25)}
  .log{height:260px;overflow:auto;background:#0c1219;border:1px solid #1e2a38;border-radius:10px;padding:8px;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px;color:#cfe1f7}
  .drawer{position:fixed;top:0;right:-420px;width:400px;max-width:90vw;height:100vh;background:linear-gradient(180deg,#0d1420,#0b0f14);border-left:1px solid #1d2732;box-shadow:-24px 0 40px rgba(0,0,0,.4);transition:right .25s ease;z-index:40;display:flex;flex-direction:column}
  .drawer.open{right:0}
  .drawer header{border-bottom:1px solid #1d2732;padding:10px 12px}
  .drawer .content{padding:12px;overflow:auto}
  .drawer .footer{margin-top:auto;padding:12px;border-top:1px solid #1d2732;display:flex;gap:8px}
  .drawer .hand{display:flex;flex-wrap:wrap;gap:8px;min-height:106px}
  .closex{position:absolute;right:12px;top:8px;border:1px solid #283648;border-radius:8px;background:#0a0f16;color:var(--muted);padding:2px 8px;font-size:12px}
  .scoreBoard{display:grid;gap:8px}
  .scoreRow{display:flex;gap:10px;align-items:center}
</style>
</head>
<body>
<header>
  <h1>Arcana — P2P</h1>
  <div class="scoreBoard">
    <div class="scoreRow"><span>P1:</span><b id="score1">0</b></div>
    <div class="scoreRow"><span>P2:</span><b id="score2">0</b></div>
    <div class="scoreRow"><span>Turn:</span><span class="pill" id="turnTag">—</span></div>
  </div>
</header>

<div class="wrap">
  <!-- Left: Controls -->
  <div class="col">
    <h2>Connect</h2>
    <div class="panel">
      <div class="row">
        <input id="signalUrl" type="text" placeholder="wss://your-signal.example.com" />
        <button id="btnUseUrl">Use URL</button>
        <span id="status" class="pill">Idle</span>
      </div>
      <div class="row" style="margin-top:8px">
        <button id="btnHost">Host</button>
        <span class="pill">Host ID: <b id="hostId">—</b></span>
      </div>
      <div class="row">
        <input id="joinId" type="text" placeholder="Enter Host ID" />
        <button id="btnJoin">Join</button>
      </div>
      <div class="row" style="margin-top:6px">
        <button id="btnStart" disabled>Start Game</button>
        <button id="btnResync" disabled>Re-sync</button>
      </div>
      <div class="piles" style="margin-top:10px">
        <div class="pile"><span class="count-tag" id="drawTag">0</span><span class="label">Draw</span></div>
        <div class="pile"><span class="count-tag" id="discardTag">0</span><span class="label">Discard</span></div>
      </div>
    </div>

    <h2>Play</h2>
    <div class="panel">
      <div class="row">
        <button id="btnConstruct">Attempt Construct</button>
        <button id="btnAction">Play 6/7/9</button>
      </div>
      <div class="row" style="margin-top:6px">
        <button id="btnSigil">Play Sigil (J/Q/K)</button>
        <button id="btnDiscard">Discard</button>
      </div>
    </div>
  </div>

  <!-- Middle: Board -->
  <div class="col">
    <h2>Board</h2>
    <div class="panel">
      <div class="zone" id="opponentZone">
        <div class="group-title">Opponent Hand (<span id="oppCount">0</span>)</div>
        <div class="group" id="opponentHand"></div>
      </div>
      <div style="height:8px"></div>
      <div class="zone" id="playerZone">
        <div class="group-title">Your Hand (<span id="youCount">0</span>)</div>
        <div class="group" id="playerHand"></div>
      </div>
    </div>
  </div>

  <!-- Right: Log -->
  <div class="col">
    <h2>Game Log</h2>
    <div class="panel">
      <div class="log" id="log"></div>
    </div>
  </div>
</div>

<!-- Drawer: 9 “give” -->
<div id="giveDrawer" class="drawer" aria-hidden="true">
  <header>
    <h1 style="margin:0">Choose a card to give (9)</h1>
    <button class="closex" id="giveClose">✕</button>
  </header>
  <div class="content">
    <div class="hand" id="giveList"></div>
  </div>
  <div class="footer">
    <button id="giveCancel">Cancel</button>
  </div>
</div>

<!-- Drawer: Joker cost -->
<div id="jokerDrawer" class="drawer" aria-hidden="true">
  <header>
    <h1 style="margin:0">Joker Cost</h1>
    <button class="closex" id="jokerClose">✕</button>
  </header>
  <div class="content">
    <p id="jokerInfo" class="pill"></p>
    <div id="jokerList" class="hand"></div>
  </div>
  <div class="footer">
    <button id="jokerCancel">Cancel</button>
    <button id="jokerConfirm">Confirm</button>
  </div>
</div>

<!-- Modal: Ace (guest side only shows when targeted) -->
<div id="aceModal" class="drawer" aria-hidden="true" style="width:420px">
  <header>
    <h1 style="margin:0">Ace Reaction</h1>
    <button class="closex" id="aceClose">✕</button>
  </header>
  <div class="content">
    <p id="aceText">Opponent played an action targeting you. Use an Ace to block?</p>
  </div>
  <div class="footer">
    <button id="aceNo">Let it resolve</button>
    <button id="aceYes">Use Ace</button>
  </div>
</div>

<script src="game.js"></script>
<script src="app.js"></script>
</body>
</html>